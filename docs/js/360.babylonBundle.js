"use strict";(self.webpackChunkbabylonjs_typescript_webpack_template=self.webpackChunkbabylonjs_typescript_webpack_template||[]).push([[360],{17582:(t,i,s)=>{s.d(i,{$Q:()=>o,OT:()=>r,mN:()=>n,q7:()=>e,yr:()=>a});class e{constructor(t,i){this.type=t,this.jointData=i,i.nativeParams=i.nativeParams||{}}get physicsJoint(){return this._physicsJoint}set physicsJoint(t){this._physicsJoint,this._physicsJoint=t}set physicsPlugin(t){this._physicsPlugin=t}executeNativeFunction(t){t(this._physicsPlugin.world,this._physicsJoint)}}e.DistanceJoint=0,e.HingeJoint=1,e.BallAndSocketJoint=2,e.WheelJoint=3,e.SliderJoint=4,e.PrismaticJoint=5,e.UniversalJoint=6,e.Hinge2Joint=e.WheelJoint,e.PointToPointJoint=8,e.SpringJoint=9,e.LockJoint=10;class n extends e{constructor(t){super(e.DistanceJoint,t)}updateDistance(t,i){this._physicsPlugin.updateDistanceJoint(this,t,i)}}class o extends e{constructor(t,i){super(t,i)}setMotor(t,i){this._physicsPlugin.setMotor(this,t||0,i)}setLimit(t,i){this._physicsPlugin.setLimit(this,t,i)}}class a extends o{constructor(t){super(e.HingeJoint,t)}setMotor(t,i){this._physicsPlugin.setMotor(this,t||0,i)}setLimit(t,i){this._physicsPlugin.setLimit(this,t,i)}}class r extends o{constructor(t){super(e.Hinge2Joint,t)}setMotor(t,i,s=0){this._physicsPlugin.setMotor(this,t||0,i,s)}setLimit(t,i,s=0){this._physicsPlugin.setLimit(this,t,i,s)}}},91503:(t,i,s)=>{var e,n,o,a,r,h,_;s.d(i,{Bq:()=>a,Rm:()=>r,Uj:()=>h,c4:()=>_,cK:()=>n,gw:()=>e,hd:()=>o}),function(t){t[t.FREE=0]="FREE",t[t.LIMITED=1]="LIMITED",t[t.LOCKED=2]="LOCKED"}(e||(e={})),function(t){t[t.LINEAR_X=0]="LINEAR_X",t[t.LINEAR_Y=1]="LINEAR_Y",t[t.LINEAR_Z=2]="LINEAR_Z",t[t.ANGULAR_X=3]="ANGULAR_X",t[t.ANGULAR_Y=4]="ANGULAR_Y",t[t.ANGULAR_Z=5]="ANGULAR_Z",t[t.LINEAR_DISTANCE=6]="LINEAR_DISTANCE"}(n||(n={})),function(t){t[t.BALL_AND_SOCKET=1]="BALL_AND_SOCKET",t[t.DISTANCE=2]="DISTANCE",t[t.HINGE=3]="HINGE",t[t.SLIDER=4]="SLIDER",t[t.LOCK=5]="LOCK",t[t.PRISMATIC=6]="PRISMATIC",t[t.SIX_DOF=7]="SIX_DOF"}(o||(o={})),function(t){t[t.SPHERE=0]="SPHERE",t[t.CAPSULE=1]="CAPSULE",t[t.CYLINDER=2]="CYLINDER",t[t.BOX=3]="BOX",t[t.CONVEX_HULL=4]="CONVEX_HULL",t[t.CONTAINER=5]="CONTAINER",t[t.MESH=6]="MESH",t[t.HEIGHTFIELD=7]="HEIGHTFIELD"}(a||(a={})),function(t){t[t.NONE=0]="NONE",t[t.VELOCITY=1]="VELOCITY",t[t.POSITION=2]="POSITION"}(r||(r={})),function(t){t.COLLISION_STARTED="COLLISION_STARTED",t.COLLISION_CONTINUED="COLLISION_CONTINUED",t.COLLISION_FINISHED="COLLISION_FINISHED",t.TRIGGER_ENTERED="TRIGGER_ENTERED",t.TRIGGER_EXITED="TRIGGER_EXITED"}(h||(h={})),function(t){t[t.STATIC=0]="STATIC",t[t.ANIMATED=1]="ANIMATED",t[t.DYNAMIC=2]="DYNAMIC"}(_||(_={}))},30766:(t,i,s)=>{s.d(i,{a:()=>C});var e=s(90972),n=s(91503),o=s(59288),a=s(37670),r=s(63239),h=s(33632),_=s(56906),l=s(37959),p=s(32085),c=s(64673);class d{constructor(t,i,s){this._vertices=[],this._indices=[],this._isRightHanded=s.useRightHandedSystem,this._collectIndices=i}addNodeMeshes(t,i){t.computeWorldMatrix(!0);const s=e.jp.Matrix[0];if(e.y3.ScalingToRef(t.absoluteScaling.x,t.absoluteScaling.y,t.absoluteScaling.z,s),t instanceof h.Kj?this._addMesh(t,s):t instanceof _.S&&this._addMesh(t.sourceMesh,s),i){const i=e.jp.Matrix[1];t.computeWorldMatrix().invertToRef(i);const n=e.jp.Matrix[2];i.multiplyToRef(s,n),t.getChildMeshes(!1).filter((t=>!t.physicsBody)).forEach((t=>{const i=t.computeWorldMatrix(),s=e.jp.Matrix[3];i.multiplyToRef(n,s),t instanceof h.Kj?this._addMesh(t,s):t instanceof _.S&&this._addMesh(t.sourceMesh,s)}))}}_addMesh(t,i){const s=t.getVerticesData(l.o.PositionKind)||[],n=s.length/3,o=this._vertices.length;for(let t=0;t<n;t++){const n=new e.P(s[3*t+0],s[3*t+1],s[3*t+2]);this._vertices.push(e.P.TransformCoordinates(n,i))}if(this._collectIndices){const i=t.getIndices();if(i)for(let t=0;t<i.length;t+=3)this._isRightHanded?(this._indices.push(i[t+0]+o),this._indices.push(i[t+1]+o),this._indices.push(i[t+2]+o)):(this._indices.push(i[t+2]+o),this._indices.push(i[t+1]+o),this._indices.push(i[t+0]+o))}}getVertices(t){const i=3*this._vertices.length,s=4*i,e=t._malloc(s),n=new Float32Array(t.HEAPU8.buffer,e,i);for(let t=0;t<this._vertices.length;t++)n[3*t+0]=this._vertices[t].x,n[3*t+1]=this._vertices[t].y,n[3*t+2]=this._vertices[t].z;return{offset:e,numObjects:i}}freeBuffer(t,i){t._free(i.offset)}getTriangles(t){const i=4*this._indices.length,s=t._malloc(i),e=new Int32Array(t.HEAPU8.buffer,s,this._indices.length);for(let t=0;t<this._indices.length;t++)e[t]=this._indices[t];return{offset:s,numObjects:this._indices.length}}}class u{constructor(t){this.hpBodyId=t,this.userMassProps={centerOfMass:void 0,mass:void 0,inertia:void 0,inertiaOrientation:void 0}}}class g{constructor(){this.bodyId=BigInt(0),this.position=new e.P,this.normal=new e.P}}class y{constructor(){this.contactOnA=new g,this.contactOnB=new g,this.impulseApplied=0,this.type=0}static readToRef(t,i,s){const e=new Int32Array(t,i),n=new Float32Array(t,i);s.contactOnA.bodyId=BigInt(e[2]),s.contactOnA.position.set(n[10],n[11],n[12]),s.contactOnA.normal.set(n[13],n[14],n[15]),s.contactOnB.bodyId=BigInt(e[18]),s.contactOnB.position.set(n[26],n[27],n[28]),s.contactOnB.normal.set(n[29],n[30],n[31]),s.impulseApplied=n[34],s.type=e[0]}}class I{constructor(){this.bodyIdA=BigInt(0),this.bodyIdB=BigInt(0),this.type=0}static readToRef(t,i,s){const e=new Int32Array(t,i);s.type=e[0],s.bodyIdA=BigInt(e[2]),s.bodyIdB=BigInt(e[6])}}class C{constructor(t=!0,i=HK){this._useDeltaForWorldStep=t,this._hknp={},this.name="HavokPlugin",this._fixedTimeStep=1/60,this._timeStep=1/60,this._tmpVec3=p.B.BuildArray(3,e.P.Zero),this._bodies=new Map,this._bodyCollisionObservable=new Map,this._bodyCollisionEndedObservable=new Map,this.onCollisionObservable=new c.y$,this.onCollisionEndedObservable=new c.y$,this.onTriggerCollisionObservable=new c.y$,"function"!=typeof i?(this._hknp=i,this.isSupported()?(this.world=this._hknp.HP_World_Create()[1],this._queryCollector=this._hknp.HP_QueryCollector_Create(1)[1]):o.Y.Error("Havok is not available. Please make sure you included the js file.")):o.Y.Error("Havok is not ready. Please make sure you await HK() before using the plugin.")}isSupported(){return void 0!==this._hknp}setGravity(t){this._hknp.HP_World_SetGravity(this.world,this._bVecToV3(t))}setTimeStep(t){this._fixedTimeStep=t}getTimeStep(){return this._fixedTimeStep}executeStep(t,i){for(const t of i)t.disablePreStep||this.setPhysicsBodyTransformation(t,t.transformNode);this._hknp.HP_World_Step(this.world,this._useDeltaForWorldStep?t:this._timeStep),this._bodyBuffer=this._hknp.HP_World_GetBodyBuffer(this.world)[1];for(const t of i)this.sync(t);this._notifyCollisions(),this._notifyTriggers()}getPluginVersion(){return 2}initBody(t,i,s,e){t._pluginData=new u(this._hknp.HP_Body_Create()[1]),this._internalSetMotionType(t._pluginData,i);const n=[this._bVecToV3(s),this._bQuatToV4(e)];this._hknp.HP_Body_SetQTransform(t._pluginData.hpBodyId,n),this._hknp.HP_World_AddBody(this.world,t._pluginData.hpBodyId,t.startAsleep),this._bodies.set(t._pluginData.hpBodyId[0],{body:t,index:0})}removeBody(t){if(t._pluginDataInstances&&t._pluginDataInstances.length>0)for(const i of t._pluginDataInstances)this._bodyCollisionObservable.delete(i.hpBodyId[0]),this._hknp.HP_World_RemoveBody(this.world,i.hpBodyId);t._pluginData&&(this._bodyCollisionObservable.delete(t._pluginData.hpBodyId[0]),this._hknp.HP_World_RemoveBody(this.world,t._pluginData.hpBodyId))}initBodyInstances(t,i,s){var e,n;const o=null!==(n=null===(e=s._thinInstanceDataStorage)||void 0===e?void 0:e.instancesCount)&&void 0!==n?n:0,a=s._thinInstanceDataStorage.matrixData;a&&(this._createOrUpdateBodyInstances(t,i,a,0,o,!1),t._pluginDataInstances.forEach(((i,s)=>{this._bodies.set(i.hpBodyId[0],{body:t,index:s})})))}_createOrUpdateBodyInstances(t,i,s,n,o,a){const r=e.jp.Quaternion[0],h=e.y3.Identity();for(let _=n;_<o;_++){const n=[s[16*_+12],s[16*_+13],s[16*_+14]];let o;o=a?t._pluginDataInstances[_].hpBodyId:this._hknp.HP_Body_Create()[1],h.setRowFromFloats(0,s[16*_+0],s[16*_+1],s[16*_+2],0),h.setRowFromFloats(1,s[16*_+4],s[16*_+5],s[16*_+6],0),h.setRowFromFloats(2,s[16*_+8],s[16*_+9],s[16*_+10],0),e._f.FromRotationMatrixToRef(h,r);const l=[n,[r.x,r.y,r.z,r.w]];if(this._hknp.HP_Body_SetQTransform(o,l),!a){const s=new u(o);t._pluginDataInstances.length&&(s.userMassProps=t._pluginDataInstances[0].userMassProps),this._internalSetMotionType(s,i),this._internalUpdateMassProperties(s),t._pluginDataInstances.push(s),this._hknp.HP_World_AddBody(this.world,o,t.startAsleep),s.worldTransformOffset=this._hknp.HP_Body_GetWorldTransformOffset(o)[1]}}}updateBodyInstances(t,i){var s,e;const n=null!==(e=null===(s=i._thinInstanceDataStorage)||void 0===s?void 0:s.instancesCount)&&void 0!==e?e:0,o=i._thinInstanceDataStorage.matrixData;if(!o)return;const a=t._pluginDataInstances.length,r=this.getMotionType(t);if(n>a){this._createOrUpdateBodyInstances(t,r,o,a,n,!1);const i=this._hknp.HP_Body_GetShape(t._pluginDataInstances[0].hpBodyId)[1];for(let s=a;s<n;s++)this._hknp.HP_Body_SetShape(t._pluginDataInstances[s].hpBodyId,i),this._internalUpdateMassProperties(t._pluginDataInstances[s]),this._bodies.set(t._pluginDataInstances[s].hpBodyId[0],{body:t,index:s})}else if(n<a){const i=a-n;for(let s=0;s<i;s++){const i=t._pluginDataInstances.pop();this._bodies.delete(i.hpBodyId[0]),this._hknp.HP_World_RemoveBody(this.world,i.hpBodyId),this._hknp.HP_Body_Release(i.hpBodyId)}this._createOrUpdateBodyInstances(t,r,o,0,n,!0)}}sync(t){this.syncTransform(t,t.transformNode)}syncTransform(t,i){var s;if(t._pluginDataInstances.length){const s=i,e=s._thinInstanceDataStorage.matrixData;if(!e)return;const n=t._pluginDataInstances.length;for(let i=0;i<n;i++){const s=t._pluginDataInstances[i].worldTransformOffset,n=new Float32Array(this._hknp.HEAPU8.buffer,this._bodyBuffer+s,16),o=16*i;for(let t=0;t<15;t++)3!=(3&t)&&(e[o+t]=n[t]);e[o+15]=1}s.thinInstanceBufferUpdated("matrix")}else try{const n=this._hknp.HP_Body_GetQTransform(t._pluginData.hpBodyId)[1],o=n[0],a=n[1],r=e.jp.Quaternion[0];r.set(a[0],a[1],a[2],a[3]);const h=i.parent;if(h&&!h.getWorldMatrix().isIdentity()){h.computeWorldMatrix(!0),r.normalize();const t=e.jp.Matrix[0],n=e.jp.Vector3[0];n.copyFromFloats(o[0],o[1],o[2]),e.y3.ComposeToRef(i.absoluteScaling,r,n,t);const a=e.jp.Matrix[1];h.getWorldMatrix().invertToRef(a);const _=e.jp.Matrix[2];t.multiplyToRef(a,_),_.decomposeToTransformNode(i),null===(s=i.rotationQuaternion)||void 0===s||s.normalize()}else i.position.set(o[0],o[1],o[2]),i.rotationQuaternion?i.rotationQuaternion.copyFrom(r):r.toEulerAnglesToRef(i.rotation)}catch(t){console.log(`Syncing transform failed for node ${i.name}: ${t.message}...`)}}setShape(t,i){var s,e,n;const o=i&&i._pluginData?i._pluginData:BigInt(0);if(!(t.transformNode instanceof h.Kj&&(null===(s=t.transformNode._thinInstanceDataStorage)||void 0===s?void 0:s.matrixData)))return this._hknp.HP_Body_SetShape(t._pluginData.hpBodyId,o),void this._internalUpdateMassProperties(t._pluginData);const a=null!==(n=null===(e=t.transformNode._thinInstanceDataStorage)||void 0===e?void 0:e.instancesCount)&&void 0!==n?n:0;for(let i=0;i<a;i++)this._hknp.HP_Body_SetShape(t._pluginDataInstances[i].hpBodyId,o),this._internalUpdateMassProperties(t._pluginDataInstances[i])}_getPluginReference(t,i){var s;return(null===(s=t._pluginDataInstances)||void 0===s?void 0:s.length)?t._pluginDataInstances[null!=i?i:0]:t._pluginData}getShape(t){const i=this._getPluginReference(t),s=this._hknp.HP_Body_GetShape(i.hpBodyId)[1];if(0!=s){const i=t.transformNode.getScene();return new r.$n({pluginData:s},i)}return null}getShapeType(t){return t.type?t.type:this._hknp.HP_Shape_GetType(t._pluginData)}setEventMask(t,i,s){this._applyToBodyOrInstances(t,(t=>{this._hknp.HP_Body_SetEventMask(t.hpBodyId,i)}),s)}getEventMask(t,i){const s=this._getPluginReference(t,i);return this._hknp.HP_Body_GetEventMask(s.hpBodyId)[1]}_fromMassPropertiesTuple(t){return{centerOfMass:e.P.FromArray(t[0]),mass:t[1],inertia:e.P.FromArray(t[2]),inertiaOrientation:e._f.FromArray(t[3])}}_internalUpdateMassProperties(t){const i=this._internalComputeMassProperties(t),s=t.userMassProps;s.centerOfMass&&(i[0]=s.centerOfMass.asArray()),null!=s.mass&&(i[1]=s.mass),s.inertia&&(i[2]=s.inertia.asArray()),s.inertiaOrientation&&(i[3]=s.inertiaOrientation.asArray()),this._hknp.HP_Body_SetMassProperties(t.hpBodyId,i)}_internalSetMotionType(t,i){switch(i){case n.c4.STATIC:this._hknp.HP_Body_SetMotionType(t.hpBodyId,this._hknp.MotionType.STATIC);break;case n.c4.ANIMATED:this._hknp.HP_Body_SetMotionType(t.hpBodyId,this._hknp.MotionType.KINEMATIC);break;case n.c4.DYNAMIC:this._hknp.HP_Body_SetMotionType(t.hpBodyId,this._hknp.MotionType.DYNAMIC)}}setMotionType(t,i,s){this._applyToBodyOrInstances(t,(t=>{this._internalSetMotionType(t,i)}),s)}getMotionType(t,i){const s=this._getPluginReference(t,i),e=this._hknp.HP_Body_GetMotionType(s.hpBodyId)[1];switch(e){case this._hknp.MotionType.STATIC:return n.c4.STATIC;case this._hknp.MotionType.KINEMATIC:return n.c4.ANIMATED;case this._hknp.MotionType.DYNAMIC:return n.c4.DYNAMIC}throw new Error("Unknown motion type: "+e)}_internalComputeMassProperties(t){const i=this._hknp.HP_Body_GetShape(t.hpBodyId);if(i[0]==this._hknp.Result.RESULT_OK){const t=this._hknp.HP_Shape_BuildMassProperties(i[1]);if(t[0]==this._hknp.Result.RESULT_OK)return t[1]}return[[0,0,0],1,[1,1,1],[0,0,0,1]]}computeMassProperties(t,i){const s=this._getPluginReference(t,i),e=this._internalComputeMassProperties(s);return this._fromMassPropertiesTuple(e)}setMassProperties(t,i,s){this._applyToBodyOrInstances(t,(t=>{t.userMassProps=i,this._internalUpdateMassProperties(t)}),s)}getMassProperties(t,i){const s=this._getPluginReference(t,i),e=this._hknp.HP_Body_GetMassProperties(s.hpBodyId)[1];return this._fromMassPropertiesTuple(e)}setLinearDamping(t,i,s){this._applyToBodyOrInstances(t,(t=>{this._hknp.HP_Body_SetLinearDamping(t.hpBodyId,i)}),s)}getLinearDamping(t,i){const s=this._getPluginReference(t,i);return this._hknp.HP_Body_GetLinearDamping(s.hpBodyId)[1]}setAngularDamping(t,i,s){this._applyToBodyOrInstances(t,(t=>{this._hknp.HP_Body_SetAngularDamping(t.hpBodyId,i)}),s)}getAngularDamping(t,i){const s=this._getPluginReference(t,i);return this._hknp.HP_Body_GetAngularDamping(s.hpBodyId)[1]}setLinearVelocity(t,i,s){this._applyToBodyOrInstances(t,(t=>{this._hknp.HP_Body_SetLinearVelocity(t.hpBodyId,this._bVecToV3(i))}),s)}getLinearVelocityToRef(t,i,s){const e=this._getPluginReference(t,s),n=this._hknp.HP_Body_GetLinearVelocity(e.hpBodyId)[1];this._v3ToBvecRef(n,i)}_applyToBodyOrInstances(t,i,s){var e;if((null===(e=t._pluginDataInstances)||void 0===e?void 0:e.length)>0&&void 0===s)for(let s=0;s<t._pluginDataInstances.length;s++)i(t._pluginDataInstances[s]);else i(this._getPluginReference(t,s))}applyImpulse(t,i,s,e){this._applyToBodyOrInstances(t,(t=>{this._hknp.HP_Body_ApplyImpulse(t.hpBodyId,this._bVecToV3(s),this._bVecToV3(i))}),e)}applyForce(t,i,s,e){i.scaleToRef(this.getTimeStep(),this._tmpVec3[0]),this.applyImpulse(t,this._tmpVec3[0],s,e)}setAngularVelocity(t,i,s){this._applyToBodyOrInstances(t,(t=>{this._hknp.HP_Body_SetAngularVelocity(t.hpBodyId,this._bVecToV3(i))}),s)}getAngularVelocityToRef(t,i,s){const e=this._getPluginReference(t,s),n=this._hknp.HP_Body_GetAngularVelocity(e.hpBodyId)[1];this._v3ToBvecRef(n,i)}setPhysicsBodyTransformation(t,i){const s=t.transformNode;if(t.numInstances>0){const i=s._thinInstanceDataStorage.matrixData;if(!i)return;const e=t.numInstances;this._createOrUpdateBodyInstances(t,t.getMotionType(),i,0,e,!0)}else this._hknp.HP_Body_SetQTransform(t._pluginData.hpBodyId,this._getTransformInfos(i))}setTargetTransform(t,i,s,e){this._applyToBodyOrInstances(t,(t=>{this._hknp.HP_Body_SetTargetQTransform(t.hpBodyId,[this._bVecToV3(i),this._bQuatToV4(s)])}),e)}setGravityFactor(t,i,s){this._applyToBodyOrInstances(t,(t=>{this._hknp.HP_Body_SetGravityFactor(t.hpBodyId,i)}),s)}getGravityFactor(t,i){const s=this._getPluginReference(t,i);return this._hknp.HP_Body_GetGravityFactor(s.hpBodyId)[1]}disposeBody(t){if(t._pluginDataInstances&&t._pluginDataInstances.length>0)for(const i of t._pluginDataInstances)this._hknp.HP_Body_Release(i.hpBodyId),i.hpBodyId=void 0;t._pluginData&&(this._hknp.HP_Body_Release(t._pluginData.hpBodyId),t._pluginData.hpBodyId=void 0)}initShape(t,i,s){switch(i){case n.Bq.SPHERE:{const i=s.radius||1,e=s.center?this._bVecToV3(s.center):[0,0,0];t._pluginData=this._hknp.HP_Shape_CreateSphere(e,i)[1]}break;case n.Bq.BOX:{const i=s.rotation?this._bQuatToV4(s.rotation):[0,0,0,1],e=s.extents?this._bVecToV3(s.extents):[1,1,1],n=s.center?this._bVecToV3(s.center):[0,0,0];t._pluginData=this._hknp.HP_Shape_CreateBox(n,i,e)[1]}break;case n.Bq.CAPSULE:{const i=s.pointA?this._bVecToV3(s.pointA):[0,0,0],e=s.pointB?this._bVecToV3(s.pointB):[0,1,0],n=s.radius||0;t._pluginData=this._hknp.HP_Shape_CreateCapsule(i,e,n)[1]}break;case n.Bq.CONTAINER:t._pluginData=this._hknp.HP_Shape_CreateContainer()[1];break;case n.Bq.CYLINDER:{const i=s.pointA?this._bVecToV3(s.pointA):[0,0,0],e=s.pointB?this._bVecToV3(s.pointB):[0,1,0],n=s.radius||0;t._pluginData=this._hknp.HP_Shape_CreateCylinder(i,e,n)[1]}break;case n.Bq.CONVEX_HULL:case n.Bq.MESH:{const e=s.mesh;if(!e)throw new Error("No mesh provided to create physics shape.");{const o=!!s.includeChildMeshes,a=i!=n.Bq.CONVEX_HULL,r=new d(e,a,null==e?void 0:e.getScene());r.addNodeMeshes(e,o);const h=r.getVertices(this._hknp),_=h.numObjects/3;if(i==n.Bq.CONVEX_HULL)t._pluginData=this._hknp.HP_Shape_CreateConvexHull(h.offset,_)[1];else{const i=r.getTriangles(this._hknp),s=i.numObjects/3;t._pluginData=this._hknp.HP_Shape_CreateMesh(h.offset,_,i.offset,s)[1],r.freeBuffer(this._hknp,i)}r.freeBuffer(this._hknp,h)}}break;default:throw new Error("Unsupported Shape Type.")}}setShapeFilterMembershipMask(t,i){const s=this._hknp.HP_Shape_GetFilterInfo(t._pluginData)[1][1];this._hknp.HP_Shape_SetFilterInfo(t._pluginData,[i,s])}getShapeFilterMembershipMask(t){return this._hknp.HP_Shape_GetFilterInfo(t._pluginData)[1][0]}setShapeFilterCollideMask(t,i){const s=this._hknp.HP_Shape_GetFilterInfo(t._pluginData)[1][0];this._hknp.HP_Shape_SetFilterInfo(t._pluginData,[s,i])}getShapeFilterCollideMask(t){return this._hknp.HP_Shape_GetFilterInfo(t._pluginData)[1][1]}setMaterial(t,i){var s,e,n,o,r;const h=null!==(s=i.friction)&&void 0!==s?s:.5,_=null!==(e=i.staticFriction)&&void 0!==e?e:h,l=null!==(n=i.restitution)&&void 0!==n?n:0,p=null!==(o=i.frictionCombine)&&void 0!==o?o:a.z.MINIMUM,c=null!==(r=i.restitutionCombine)&&void 0!==r?r:a.z.MAXIMUM,d=[_,h,l,this._materialCombineToNative(p),this._materialCombineToNative(c)];this._hknp.HP_Shape_SetMaterial(t._pluginData,d)}setDensity(t,i){this._hknp.HP_Shape_SetDensity(t._pluginData,i)}getDensity(t){return this._hknp.HP_Shape_GetDensity(t._pluginData)[1]}_getTransformInfos(t){if(t.parent)return t.computeWorldMatrix(!0),[this._bVecToV3(t.absolutePosition),this._bQuatToV4(t.absoluteRotationQuaternion)];let i=e.jp.Quaternion[0];if(t.rotationQuaternion)i=t.rotationQuaternion;else{const s=t.rotation;e._f.FromEulerAnglesToRef(s.x,s.y,s.z,i)}return[this._bVecToV3(t.position),this._bQuatToV4(i)]}addChild(t,i,s,e,n){const o=[s?this._bVecToV3(s):[0,0,0],e?this._bQuatToV4(e):[0,0,0,1],n?this._bVecToV3(n):[1,1,1]];this._hknp.HP_Shape_AddChild(t._pluginData,i._pluginData,o)}removeChild(t,i){this._hknp.HP_Shape_RemoveChild(t._pluginData,i)}getNumChildren(t){return this._hknp.HP_Shape_GetNumChildren(t._pluginData)[1]}setTrigger(t,i){this._hknp.HP_Shape_SetTrigger(t._pluginData,i)}getBoundingBox(t){return{}}getBodyGeometry(t){var i;const s=(null===(i=t._pluginDataInstances)||void 0===i?void 0:i.length)>0?t._pluginDataInstances[0]:t._pluginData,e=this._hknp.HP_Body_GetShape(s.hpBodyId)[1],n=this._hknp.HP_Shape_CreateDebugDisplayGeometry(e);if(n[0]!=this._hknp.Result.RESULT_OK)return{positions:[],indices:[]};const o=this._hknp.HP_DebugGeometry_GetInfo(n[1])[1],a=new Float32Array(this._hknp.HEAPU8.buffer,o[0],3*o[1]),r=new Uint32Array(this._hknp.HEAPU8.buffer,o[2],3*o[3]),h=a.slice(0),_=r.slice(0);return this._hknp.HP_DebugGeometry_Release(n[1]),{positions:h,indices:_}}disposeShape(t){this._hknp.HP_Shape_Release(t._pluginData),t._pluginData=void 0}initConstraint(t,i,s,a,r){var h,_,l,p,c;const d=t.type,u=t.options;if(!d||!u)return void o.Y.Warn("No constraint type or options. Constraint is invalid.");if(i._pluginDataInstances.length>0&&void 0===a||s._pluginDataInstances.length>0&&void 0===r)return void o.Y.Warn("Body is instanced but no instance index was specified. Constraint will not be applied.");t._pluginData=null!==(h=t._pluginData)&&void 0!==h?h:[];const g=this._hknp.HP_Constraint_Create()[1];t._pluginData.push(g);const y=this._getPluginReference(i,a).hpBodyId,I=this._getPluginReference(s,r).hpBodyId;this._hknp.HP_Constraint_SetParentBody(g,y),this._hknp.HP_Constraint_SetChildBody(g,I);const C=u.pivotA?this._bVecToV3(u.pivotA):this._bVecToV3(e.P.Zero()),A=null!==(_=u.axisA)&&void 0!==_?_:new e.P(1,0,0),T=this._tmpVec3[0];u.perpAxisA?T.copyFrom(u.perpAxisA):A.getNormalToRef(T),this._hknp.HP_Constraint_SetAnchorInParent(g,C,this._bVecToV3(A),this._bVecToV3(T));const P=u.pivotB?this._bVecToV3(u.pivotB):this._bVecToV3(e.P.Zero()),M=null!==(l=u.axisB)&&void 0!==l?l:new e.P(1,0,0),E=this._tmpVec3[0];if(u.perpAxisB?E.copyFrom(u.perpAxisB):M.getNormalToRef(E),this._hknp.HP_Constraint_SetAnchorInChild(g,P,this._bVecToV3(M),this._bVecToV3(E)),d==n.hd.LOCK)this._hknp.HP_Constraint_SetAxisMode(g,this._hknp.ConstraintAxis.LINEAR_X,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(g,this._hknp.ConstraintAxis.LINEAR_Y,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(g,this._hknp.ConstraintAxis.LINEAR_Z,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(g,this._hknp.ConstraintAxis.ANGULAR_X,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(g,this._hknp.ConstraintAxis.ANGULAR_Y,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(g,this._hknp.ConstraintAxis.ANGULAR_Z,this._hknp.ConstraintAxisLimitMode.LOCKED);else if(d==n.hd.DISTANCE){const t=u.maxDistance||0,i=this._hknp.ConstraintAxis.LINEAR_DISTANCE;this._hknp.HP_Constraint_SetAxisMode(g,i,this._hknp.ConstraintAxisLimitMode.LIMITED),this._hknp.HP_Constraint_SetAxisMinLimit(g,i,t),this._hknp.HP_Constraint_SetAxisMaxLimit(g,i,t)}else if(d==n.hd.HINGE)this._hknp.HP_Constraint_SetAxisMode(g,this._hknp.ConstraintAxis.LINEAR_X,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(g,this._hknp.ConstraintAxis.LINEAR_Y,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(g,this._hknp.ConstraintAxis.LINEAR_Z,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(g,this._hknp.ConstraintAxis.ANGULAR_Y,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(g,this._hknp.ConstraintAxis.ANGULAR_Z,this._hknp.ConstraintAxisLimitMode.LOCKED);else if(d==n.hd.PRISMATIC)this._hknp.HP_Constraint_SetAxisMode(g,this._hknp.ConstraintAxis.LINEAR_Y,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(g,this._hknp.ConstraintAxis.LINEAR_Z,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(g,this._hknp.ConstraintAxis.ANGULAR_X,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(g,this._hknp.ConstraintAxis.ANGULAR_Y,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(g,this._hknp.ConstraintAxis.ANGULAR_Z,this._hknp.ConstraintAxisLimitMode.LOCKED);else if(d==n.hd.SLIDER)this._hknp.HP_Constraint_SetAxisMode(g,this._hknp.ConstraintAxis.LINEAR_Y,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(g,this._hknp.ConstraintAxis.LINEAR_Z,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(g,this._hknp.ConstraintAxis.ANGULAR_Y,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(g,this._hknp.ConstraintAxis.ANGULAR_Z,this._hknp.ConstraintAxisLimitMode.LOCKED);else if(d==n.hd.BALL_AND_SOCKET)this._hknp.HP_Constraint_SetAxisMode(g,this._hknp.ConstraintAxis.LINEAR_X,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(g,this._hknp.ConstraintAxis.LINEAR_Y,this._hknp.ConstraintAxisLimitMode.LOCKED),this._hknp.HP_Constraint_SetAxisMode(g,this._hknp.ConstraintAxis.LINEAR_Z,this._hknp.ConstraintAxisLimitMode.LOCKED);else{if(d!=n.hd.SIX_DOF)throw new Error("Unsupported Constraint Type.");{const i=t;for(const t of i.limits){const i=this._constraintAxisToNative(t.axis);0==(null!==(p=t.minLimit)&&void 0!==p?p:-1)&&0==(null!==(c=t.maxLimit)&&void 0!==c?c:-1)?this._hknp.HP_Constraint_SetAxisMode(g,i,this._hknp.ConstraintAxisLimitMode.LOCKED):(null!=t.minLimit&&(this._hknp.HP_Constraint_SetAxisMode(g,i,this._hknp.ConstraintAxisLimitMode.LIMITED),this._hknp.HP_Constraint_SetAxisMinLimit(g,i,t.minLimit)),null!=t.maxLimit&&(this._hknp.HP_Constraint_SetAxisMode(g,i,this._hknp.ConstraintAxisLimitMode.LIMITED),this._hknp.HP_Constraint_SetAxisMaxLimit(g,i,t.maxLimit))),t.stiffness&&this._hknp.HP_Constraint_SetAxisStiffness(g,i,t.stiffness),t.damping&&this._hknp.HP_Constraint_SetAxisDamping(g,i,t.damping)}}}const m=!!u.collision;this._hknp.HP_Constraint_SetCollisionsEnabled(g,m),this._hknp.HP_Constraint_SetEnabled(g,!0)}addConstraint(t,i,s,e,n){this.initConstraint(s,t,i,e,n)}setEnabled(t,i){for(const s of t._pluginData)this._hknp.HP_Constraint_SetEnabled(s,i)}getEnabled(t){const i=t._pluginData&&t._pluginData[0];return!!i&&this._hknp.HP_Constraint_GetEnabled(i)[1]}setCollisionsEnabled(t,i){for(const s of t._pluginData)this._hknp.HP_Constraint_SetCollisionsEnabled(s,i)}getCollisionsEnabled(t){const i=t._pluginData&&t._pluginData[0];return!!i&&this._hknp.HP_Constraint_GetCollisionsEnabled(i)[1]}setAxisFriction(t,i,s){for(const e of t._pluginData)this._hknp.HP_Constraint_SetAxisFriction(e,this._constraintAxisToNative(i),s)}getAxisFriction(t,i){const s=t._pluginData&&t._pluginData[0];return s?this._hknp.HP_Constraint_GetAxisFriction(s,this._constraintAxisToNative(i))[1]:null}setAxisMode(t,i,s){for(const e of t._pluginData)this._hknp.HP_Constraint_SetAxisMode(e,this._constraintAxisToNative(i),this._limitModeToNative(s))}getAxisMode(t,i){const s=t._pluginData&&t._pluginData[0];if(s){const t=this._hknp.HP_Constraint_GetAxisMode(s,this._constraintAxisToNative(i))[1];return this._nativeToLimitMode(t)}return null}setAxisMinLimit(t,i,s){for(const e of t._pluginData)this._hknp.HP_Constraint_SetAxisMinLimit(e,this._constraintAxisToNative(i),s)}getAxisMinLimit(t,i){const s=t._pluginData&&t._pluginData[0];return s?this._hknp.HP_Constraint_GetAxisMinLimit(s,this._constraintAxisToNative(i))[1]:null}setAxisMaxLimit(t,i,s){for(const e of t._pluginData)this._hknp.HP_Constraint_SetAxisMaxLimit(e,this._constraintAxisToNative(i),s)}getAxisMaxLimit(t,i){const s=t._pluginData&&t._pluginData[0];return s?this._hknp.HP_Constraint_GetAxisMaxLimit(s,this._constraintAxisToNative(i))[1]:null}setAxisMotorType(t,i,s){for(const e of t._pluginData)this._hknp.HP_Constraint_SetAxisMotorType(e,this._constraintAxisToNative(i),this._constraintMotorTypeToNative(s))}getAxisMotorType(t,i){const s=t._pluginData&&t._pluginData[0];return s?this._nativeToMotorType(this._hknp.HP_Constraint_GetAxisMotorType(s,this._constraintAxisToNative(i))[1]):null}setAxisMotorTarget(t,i,s){for(const e of t._pluginData)this._hknp.HP_Constraint_SetAxisMotorTarget(e,this._constraintAxisToNative(i),s)}getAxisMotorTarget(t,i){return t._pluginData&&t._pluginData[0]?this._hknp.HP_Constraint_GetAxisMotorTarget(t._pluginData,this._constraintAxisToNative(i))[1]:null}setAxisMotorMaxForce(t,i,s){for(const e of t._pluginData)this._hknp.HP_Constraint_SetAxisMotorMaxForce(e,this._constraintAxisToNative(i),s)}getAxisMotorMaxForce(t,i){const s=t._pluginData&&t._pluginData[0];return s?this._hknp.HP_Constraint_GetAxisMotorMaxForce(s,this._constraintAxisToNative(i))[1]:null}disposeConstraint(t){for(const i of t._pluginData)this._hknp.HP_Constraint_SetEnabled(i,!1),this._hknp.HP_Constraint_Release(i);t._pluginData.length=0}raycast(t,i,s,e){var n,o;const a=null!==(n=null==e?void 0:e.membership)&&void 0!==n?n:-1,r=null!==(o=null==e?void 0:e.collideWith)&&void 0!==o?o:-1;s.reset(t,i);const h=[this._bVecToV3(t),this._bVecToV3(i),[a,r]];if(this._hknp.HP_World_CastRayWithCollector(this.world,this._queryCollector,h),this._hknp.HP_QueryCollector_GetNumHits(this._queryCollector)[1]>0){const t=this._hknp.HP_QueryCollector_GetCastRayResult(this._queryCollector,0)[1],i=t[1][3],e=t[1][4],n=t[1][5];s.setHitData({x:e[0],y:e[1],z:e[2]},{x:i[0],y:i[1],z:i[2]},n),s.calculateHitDistance();const o=this._bodies.get(t[1][0][0]);s.body=null==o?void 0:o.body,s.bodyIndex=null==o?void 0:o.index}}getCollisionObservable(t){const i=t._pluginData.hpBodyId[0];let s=this._bodyCollisionObservable.get(i);return s||(s=new c.y$,this._bodyCollisionObservable.set(i,s)),s}getCollisionEndedObservable(t){const i=t._pluginData.hpBodyId[0];let s=this._bodyCollisionEndedObservable.get(i);return s||(s=new c.y$,this._bodyCollisionEndedObservable.set(i,s)),s}setCollisionCallbackEnabled(t,i){const s=this._hknp.EventType.COLLISION_STARTED.value|this._hknp.EventType.COLLISION_CONTINUED.value|this._hknp.EventType.COLLISION_FINISHED.value;t._pluginDataInstances&&t._pluginDataInstances.length?t._pluginDataInstances.forEach((t=>{this._hknp.HP_Body_SetEventMask(t.hpBodyId,i?s:0)})):t._pluginData&&this._hknp.HP_Body_SetEventMask(t._pluginData.hpBodyId,i?s:0)}setCollisionEndedCallbackEnabled(t,i){const s=this._getPluginReference(t);let e=this._hknp.HP_Body_GetEventMask(s.hpBodyId)[1];e=i?e|this._hknp.EventType.COLLISION_FINISHED.value:e&~this._hknp.EventType.COLLISION_FINISHED.value,t._pluginDataInstances&&t._pluginDataInstances.length?t._pluginDataInstances.forEach((t=>{this._hknp.HP_Body_SetEventMask(t.hpBodyId,e)})):t._pluginData&&this._hknp.HP_Body_SetEventMask(t._pluginData.hpBodyId,e)}_notifyTriggers(){let t=this._hknp.HP_World_GetTriggerEvents(this.world)[1];const i=new I;for(;t;){I.readToRef(this._hknp.HEAPU8.buffer,t,i);const s=this._bodies.get(i.bodyIdA),e=this._bodies.get(i.bodyIdB),n={collider:s.body,colliderIndex:s.index,collidedAgainst:e.body,collidedAgainstIndex:e.index,type:this._nativeTriggerCollisionValueToCollisionType(i.type)};this.onTriggerCollisionObservable.notifyObservers(n),t=this._hknp.HP_World_GetNextTriggerEvent(this.world,t)}}_notifyCollisions(){let t=this._hknp.HP_World_GetCollisionEvents(this.world)[1];const i=new y,s=Number(this.world);for(;t;){y.readToRef(this._hknp.HEAPU8.buffer,t,i);const o=this._bodies.get(i.contactOnA.bodyId),a=this._bodies.get(i.contactOnB.bodyId),r={collider:o.body,colliderIndex:o.index,collidedAgainst:a.body,collidedAgainstIndex:a.index,type:this._nativeCollisionValueToCollisionType(i.type)};if(r.type===n.Uj.COLLISION_FINISHED)this.onCollisionEndedObservable.notifyObservers(r);else{i.contactOnB.position.subtractToRef(i.contactOnA.position,this._tmpVec3[0]);const t=e.P.Dot(this._tmpVec3[0],i.contactOnA.normal);r.point=i.contactOnA.position,r.distance=t,r.impulse=i.impulseApplied,r.normal=i.contactOnA.normal,this.onCollisionObservable.notifyObservers(r)}if(this._bodyCollisionObservable.size&&r.type!==n.Uj.COLLISION_FINISHED){const t=this._bodyCollisionObservable.get(i.contactOnA.bodyId),s=this._bodyCollisionObservable.get(i.contactOnB.bodyId);t?t.notifyObservers(r):s&&(r.collider=a.body,r.colliderIndex=a.index,r.collidedAgainst=o.body,r.collidedAgainstIndex=o.index,r.normal=i.contactOnB.normal,s.notifyObservers(r))}else if(this._bodyCollisionEndedObservable.size){const t=this._bodyCollisionEndedObservable.get(i.contactOnA.bodyId),s=this._bodyCollisionEndedObservable.get(i.contactOnB.bodyId);t?t.notifyObservers(r):s&&(r.collider=a.body,r.colliderIndex=a.index,r.collidedAgainst=o.body,r.collidedAgainstIndex=o.index,r.normal=i.contactOnB.normal,s.notifyObservers(r))}t=this._hknp.HP_World_GetNextCollisionEvent(s,t)}}get numBodies(){return this._hknp.HP_World_GetNumBodies(this.world)[1]}dispose(){this._hknp.HP_QueryCollector_Release(this._queryCollector),this._queryCollector=BigInt(0),this._hknp.HP_World_Release(this.world),this.world=void 0}_v3ToBvecRef(t,i){i.set(t[0],t[1],t[2])}_bVecToV3(t){return[t._x,t._y,t._z]}_bQuatToV4(t){return[t._x,t._y,t._z,t._w]}_constraintMotorTypeToNative(t){switch(t){case n.Rm.POSITION:return this._hknp.ConstraintMotorType.POSITION;case n.Rm.VELOCITY:return this._hknp.ConstraintMotorType.VELOCITY}return this._hknp.ConstraintMotorType.NONE}_nativeToMotorType(t){switch(t){case this._hknp.ConstraintMotorType.POSITION:return n.Rm.POSITION;case this._hknp.ConstraintMotorType.VELOCITY:return n.Rm.VELOCITY}return n.Rm.NONE}_materialCombineToNative(t){switch(t){case a.z.GEOMETRIC_MEAN:return this._hknp.MaterialCombine.GEOMETRIC_MEAN;case a.z.MINIMUM:return this._hknp.MaterialCombine.MINIMUM;case a.z.MAXIMUM:return this._hknp.MaterialCombine.MAXIMUM;case a.z.ARITHMETIC_MEAN:return this._hknp.MaterialCombine.ARITHMETIC_MEAN;case a.z.MULTIPLY:return this._hknp.MaterialCombine.MULTIPLY}}_constraintAxisToNative(t){switch(t){case n.cK.LINEAR_X:return this._hknp.ConstraintAxis.LINEAR_X;case n.cK.LINEAR_Y:return this._hknp.ConstraintAxis.LINEAR_Y;case n.cK.LINEAR_Z:return this._hknp.ConstraintAxis.LINEAR_Z;case n.cK.ANGULAR_X:return this._hknp.ConstraintAxis.ANGULAR_X;case n.cK.ANGULAR_Y:return this._hknp.ConstraintAxis.ANGULAR_Y;case n.cK.ANGULAR_Z:return this._hknp.ConstraintAxis.ANGULAR_Z;case n.cK.LINEAR_DISTANCE:return this._hknp.ConstraintAxis.LINEAR_DISTANCE}}_nativeToLimitMode(t){switch(t){case this._hknp.ConstraintAxisLimitMode.FREE:return n.gw.FREE;case this._hknp.ConstraintAxisLimitMode.LIMITED:return n.gw.LIMITED;case this._hknp.ConstraintAxisLimitMode.LOCKED:return n.gw.LOCKED}return n.gw.FREE}_limitModeToNative(t){switch(t){case n.gw.FREE:return this._hknp.ConstraintAxisLimitMode.FREE;case n.gw.LIMITED:return this._hknp.ConstraintAxisLimitMode.LIMITED;case n.gw.LOCKED:return this._hknp.ConstraintAxisLimitMode.LOCKED}}_nativeCollisionValueToCollisionType(t){switch(t){case this._hknp.EventType.COLLISION_STARTED.value:return n.Uj.COLLISION_STARTED;case this._hknp.EventType.COLLISION_FINISHED.value:return n.Uj.COLLISION_FINISHED;case this._hknp.EventType.COLLISION_CONTINUED.value:return n.Uj.COLLISION_CONTINUED}return n.Uj.COLLISION_STARTED}_nativeTriggerCollisionValueToCollisionType(t){switch(t){case 8:return n.Uj.TRIGGER_ENTERED;case 16:return n.Uj.TRIGGER_EXITED}return n.Uj.TRIGGER_ENTERED}}},98830:(t,i,s)=>{s.d(i,{Q:()=>o});var e=s(90972),n=s(730);class o{constructor(t,i,s,n){if(this._pluginData=void 0,this._pluginDataInstances=[],this._collisionCBEnabled=!1,this._collisionEndedCBEnabled=!1,this.disablePreStep=!0,!n)return;const o=n.getPhysicsEngine();if(!o)throw new Error("No Physics Engine available.");if(this._physicsEngine=o,2!=o.getPluginVersion())throw new Error("Plugin version is incorrect. Expected version 2.");const a=o.getPhysicsPlugin();if(!a)throw new Error("No Physics Plugin available.");this._physicsPlugin=a,t.rotationQuaternion||(t.rotationQuaternion=e._f.FromEulerAngles(t.rotation.x,t.rotation.y,t.rotation.z)),this.startAsleep=s;const r=t;r.hasThinInstances?this._physicsPlugin.initBodyInstances(this,i,r):(t.parent&&t.computeWorldMatrix(!0),this._physicsPlugin.initBody(this,i,t.absolutePosition,t.absoluteRotationQuaternion)),this.transformNode=t,t.physicsBody=this,o.addBody(this),this._nodeDisposeObserver=t.onDisposeObservable.add((()=>{this.dispose()}))}getClassName(){return"PhysicsBody"}clone(t){const i=new o(t,this.getMotionType(),this.startAsleep,this.transformNode.getScene());return i.shape=this.shape,i.setMassProperties(this.getMassProperties()),i.setLinearDamping(this.getLinearDamping()),i.setAngularDamping(this.getAngularDamping()),i}updateBodyInstances(){const t=this.transformNode;t.hasThinInstances&&this._physicsPlugin.updateBodyInstances(this,t)}get numInstances(){return this._pluginDataInstances.length}set shape(t){this._physicsPlugin.setShape(this,t)}get shape(){return this._physicsPlugin.getShape(this)}setEventMask(t,i){this._physicsPlugin.setEventMask(this,t,i)}getEventMask(t){return this._physicsPlugin.getEventMask(this,t)}setMotionType(t,i){this._physicsPlugin.setMotionType(this,t,i)}getMotionType(t){return this._physicsPlugin.getMotionType(this,t)}computeMassProperties(t){return this._physicsPlugin.computeMassProperties(this,t)}setMassProperties(t,i){this._physicsPlugin.setMassProperties(this,t,i)}getMassProperties(t){return this._physicsPlugin.getMassProperties(this,t)}setLinearDamping(t,i){this._physicsPlugin.setLinearDamping(this,t,i)}getLinearDamping(t){return this._physicsPlugin.getLinearDamping(this,t)}setAngularDamping(t,i){this._physicsPlugin.setAngularDamping(this,t,i)}getAngularDamping(t){return this._physicsPlugin.getAngularDamping(this,t)}setLinearVelocity(t,i){this._physicsPlugin.setLinearVelocity(this,t,i)}getLinearVelocityToRef(t,i){return this._physicsPlugin.getLinearVelocityToRef(this,t,i)}getLinearVelocity(t){const i=new e.P;return this.getLinearVelocityToRef(i,t),i}setAngularVelocity(t,i){this._physicsPlugin.setAngularVelocity(this,t,i)}getAngularVelocityToRef(t,i){return this._physicsPlugin.getAngularVelocityToRef(this,t,i)}getAngularVelocity(t){const i=new e.P;return this.getAngularVelocityToRef(i,t),i}applyImpulse(t,i,s){this._physicsPlugin.applyImpulse(this,t,i,s)}applyForce(t,i,s){this._physicsPlugin.applyForce(this,t,i,s)}getGeometry(){return this._physicsPlugin.getBodyGeometry(this)}getCollisionObservable(){return this._physicsPlugin.getCollisionObservable(this)}getCollisionEndedObservable(){return this._physicsPlugin.getCollisionEndedObservable(this)}setCollisionCallbackEnabled(t){this._collisionCBEnabled=t,this._physicsPlugin.setCollisionCallbackEnabled(this,t)}setCollisionEndedCallbackEnabled(t){this._collisionEndedCBEnabled=t,this._physicsPlugin.setCollisionEndedCallbackEnabled(this,t)}getObjectCenterWorld(t){const i=new e.P;return this.getObjectCenterWorldToRef(i,t)}getObjectCenterWorldToRef(t,i){var s;if((null===(s=this._pluginDataInstances)||void 0===s?void 0:s.length)>0){const s=i||0,e=this.transformNode._thinInstanceDataStorage.matrixData;e&&t.set(e[16*s+12],e[16*s+13],e[16*s+14])}else t.copyFrom(this.transformNode.position);return t}addConstraint(t,i,s,e){this._physicsPlugin.addConstraint(this,t,i,s,e)}syncWithBone(t,i,s,o,a,r){const h=this.transformNode;if(h.rotationQuaternion)if(a){const s=e.jp.Quaternion[0];t.getRotationQuaternionToRef(n.T.WORLD,i,s),s.multiplyToRef(a,h.rotationQuaternion)}else t.getRotationQuaternionToRef(n.T.WORLD,i,h.rotationQuaternion);const _=e.jp.Vector3[0],l=e.jp.Vector3[1];r||((r=e.jp.Vector3[2]).x=0,r.y=1,r.z=0),t.getDirectionToRef(r,i,l),t.getAbsolutePositionToRef(i,_),null==o&&s&&(o=s.length()),null!=o&&(_.x+=l.x*o,_.y+=l.y*o,_.z+=l.z*o),h.setAbsolutePosition(_)}iterateOverAllInstances(t){var i;if((null===(i=this._pluginDataInstances)||void 0===i?void 0:i.length)>0)for(let i=0;i<this._pluginDataInstances.length;i++)t(this,i);else t(this,void 0)}setGravityFactor(t,i){this._physicsPlugin.setGravityFactor(this,t,i)}getGravityFactor(t){return this._physicsPlugin.getGravityFactor(this,t)}setTargetTransform(t,i,s){this._physicsPlugin.setTargetTransform(this,t,i,s)}dispose(){this._collisionCBEnabled&&this.setCollisionCallbackEnabled(!1),this._collisionEndedCBEnabled&&this.setCollisionEndedCallbackEnabled(!1),this._nodeDisposeObserver&&(this.transformNode.onDisposeObservable.remove(this._nodeDisposeObserver),this._nodeDisposeObserver=null),this._physicsEngine.removeBody(this),this._physicsPlugin.removeBody(this),this._physicsPlugin.disposeBody(this),this.transformNode.physicsBody=null,this._pluginData=null,this._pluginDataInstances.length=0}}},37670:(t,i,s)=>{var e;s.d(i,{z:()=>e}),function(t){t[t.GEOMETRIC_MEAN=0]="GEOMETRIC_MEAN",t[t.MINIMUM=1]="MINIMUM",t[t.MAXIMUM=2]="MAXIMUM",t[t.ARITHMETIC_MEAN=3]="ARITHMETIC_MEAN",t[t.MULTIPLY=4]="MULTIPLY"}(e||(e={}))},63239:(t,i,s)=>{s.d(i,{$n:()=>o,A1:()=>l,Tk:()=>h,V_:()=>a,gA:()=>p,oz:()=>r,vJ:()=>c,y2:()=>_});var e=s(91503),n=s(90972);class o{constructor(t,i){var s;if(this._pluginData=void 0,this._isTrigger=!1,!i)return;const e=i.getPhysicsEngine();if(!e)throw new Error("No Physics Engine available.");if(2!=e.getPluginVersion())throw new Error("Plugin version is incorrect. Expected version 2.");const n=e.getPhysicsPlugin();if(!n)throw new Error("No Physics Plugin available.");if(this._physicsPlugin=n,void 0!==t.pluginData&&null!==t.pluginData)this._pluginData=t.pluginData,this._type=this._physicsPlugin.getShapeType(this);else if(void 0!==t.type&&null!==t.type){this._type=t.type;const i=null!==(s=t.parameters)&&void 0!==s?s:{};this._physicsPlugin.initShape(this,t.type,i)}}getClassName(){return"PhysicsShape"}get type(){return this._type}set filterMembershipMask(t){this._physicsPlugin.setShapeFilterMembershipMask(this,t)}get filterMembershipMask(){return this._physicsPlugin.getShapeFilterMembershipMask(this)}set filterCollideMask(t){this._physicsPlugin.setShapeFilterCollideMask(this,t)}get filterCollideMask(){return this._physicsPlugin.getShapeFilterCollideMask(this)}set material(t){this._physicsPlugin.setMaterial(this,t),this._material=t}get material(){return this._material}set density(t){this._physicsPlugin.setDensity(this,t)}get density(){return this._physicsPlugin.getDensity(this)}addChildFromParent(t,i,s){const e=s.computeWorldMatrix(!0),o=t.computeWorldMatrix(!0),a=n.jp.Matrix[0];e.multiplyToRef(n.y3.Invert(o),a);const r=n.jp.Vector3[0],h=n.jp.Quaternion[0],_=n.jp.Vector3[1];a.decompose(_,h,r),this._physicsPlugin.addChild(this,i,r,h,_)}addChild(t,i,s,e){this._physicsPlugin.addChild(this,t,i,s,e)}removeChild(t){this._physicsPlugin.removeChild(this,t)}getNumChildren(){return this._physicsPlugin.getNumChildren(this)}getBoundingBox(){return this._physicsPlugin.getBoundingBox(this)}set isTrigger(t){this._isTrigger!==t&&(this._isTrigger=t,this._physicsPlugin.setTrigger(this,t))}get isTrigger(){return this._isTrigger}dispose(){this._physicsPlugin.disposeShape(this)}}class a extends o{constructor(t,i,s){super({type:e.Bq.SPHERE,parameters:{center:t,radius:i}},s)}static FromMesh(t){const i=t.getBoundingInfo(),s=i.boundingSphere.center,e=i.boundingBox.extendSize,n=Math.max(e.x,e.y,e.z);return new a(s,n,t.getScene())}}class r extends o{constructor(t,i,s,n){super({type:e.Bq.CAPSULE,parameters:{pointA:t,pointB:i,radius:s}},n)}static FromMesh(t){const i=t.getBoundingInfo(),s=i.boundingBox.extendSize.x,e=new n.P(0,i.boundingBox.extendSize.y-s,0),o=i.boundingBox.center.add(e),a=i.boundingBox.center.subtract(e);return new r(o,a,s,t.getScene())}}class h extends o{constructor(t,i,s,n){super({type:e.Bq.CYLINDER,parameters:{pointA:t,pointB:i,radius:s}},n)}static FromMesh(t){const i=t.getBoundingInfo(),s=i.boundingBox.extendSize.x,e=new n.P(0,i.boundingBox.extendSize.y,0),o=i.boundingBox.center.add(e),a=i.boundingBox.center.subtract(e);return new h(o,a,s,t.getScene())}}class _ extends o{constructor(t,i,s,n){super({type:e.Bq.BOX,parameters:{center:t,rotation:i,extents:s}},n)}static FromMesh(t){const i=t.getBoundingInfo(),s=i.boundingBox.center,e=i.boundingBox.extendSize.scale(2);return new _(s,n._f.Identity(),e,t.getScene())}}class l extends o{constructor(t,i){super({type:e.Bq.CONVEX_HULL,parameters:{mesh:t}},i)}}class p extends o{constructor(t,i){super({type:e.Bq.MESH,parameters:{mesh:t}},i)}}class c extends o{constructor(t){super({type:e.Bq.CONTAINER,parameters:{}},t)}}}}]);
//# sourceMappingURL=360.babylonBundle.js.map