"use strict";(self.webpackChunkbabylonjs_typescript_webpack_template=self.webpackChunkbabylonjs_typescript_webpack_template||[]).push([[426],{5426:(e,t,n)=>{n.r(t),n.d(t,{DefaultSceneWithTexture:()=>f,default:()=>y});var o=n(4147),r=n(3579),i=n(972),s=n(307),a=n(3242),l=n(388),c=n(4684),u=n(1552),d=n(3789),m=n(6070),b=n(4404);function h(e,t,n){const o=function(e,t){const n=t.getWorldMatrix(),o=new i.y3;return n.invertToRef(o),i.P.TransformCoordinates(e,o)}(e,t),r=function(e,t){const n=t.bbox.min;if(o=e,r=t.bbox.min,s=t.bbox.max,!(o.x>=r.x&&o.y>=r.y&&o.z>=r.z&&o.x<=s.x&&o.y<=s.y&&o.z<=s.z))return-1;var o,r,s;let a=e.subtract(n);a=a.divide(new i.P(t.cellSize,t.cellSize,t.cellSize));const l=new i.P(Math.round(a.x),Math.round(a.y),Math.round(a.z));return c=l.x,u=l.y,d=l.z,c+(m=t.res).x*(u+m.y*d);var c,u,d,m}(o,n);return-1===r?-1:n.distances[r]}n(1723);function p(e,t,n,o,r){const i=Math.pow(t.subtract(e).length(),2)/2,s=n,a=new l.Vector3(o.x,o.y,o.z);return.01*r/(1+5/(2*i)*Math.pow(s.cross(a).length(),2))}const g=n.p+"628b10094e62129397fc4859ae7349d6.stl";var w=n(8474);class f{constructor(){this.createScene=async(e,t)=>{const f=new o.x(e);Promise.all([Promise.resolve().then(n.bind(n,1568)),Promise.all([n.e(319),n.e(596)]).then(n.t.bind(n,3596,23))]).then((e=>{console.log(e),f.debugLayer.show({handleResize:!0,overlay:!0,globalRoot:document.getElementById("#root")||void 0})})),b.a.DO_NOT_ALTER_FILE_COORDINATES=!0;const y=(await l.SceneLoader.ImportMeshAsync("","",g,f,void 0,".stl")).meshes[0];y.scaling=new i.P(1,1,-1);const x=await l.SceneLoader.ImportMeshAsync("","",g,f,void 0,".stl"),P=x.meshes[0];P.name="NagelPuzzleMoveable",P.visibility=1,P.scaling=new i.P(1,1,-1);const C=new l.Mesh("NagelPunkte",f);C.parent=x.meshes[0];const M=async function(e){try{const e=await fetch("https://raw.githubusercontent.com/P-Miha/Kyros-Zylinder/master/assets/SDFInformation/Nagel1.noff");return await e.text()}catch(e){throw console.error("Fehler beim Laden der Off-Datei:",e),e}}(),v=function(e){const t=e.trim().split("\n"),n=[],o=[];for(let e=3;e<t.length;e++){const r=t[e].trim().split(" ").map(parseFloat);if(r.length>=3){const e=l.Vector3.FromArray(r.slice(0,3));if(n.push(e),r.length>=6){const e=l.Vector3.FromArray(r.slice(3,6));o.push(e)}}}return{vertices:n,normals:o}}(await M),S=v.vertices,z=v.normals;for(let e=0;e<S.length;e++){const t=new l.Mesh("Punkt"+e,f);t.position=S[e],t.parent=C,t.visibility=0}P.position=new i.P(-.5,1,0),y.position=new i.P(0,1,0),P.rotationQuaternion=i._f.FromEulerVector(new i.P(Math.PI/2,Math.PI,0)),P.scaling=new i.P(.01,.01,.01),y.scaling=new i.P(.01,.01,.01);const I=async function(e){try{const e=await fetch("https://raw.githubusercontent.com/P-Miha/Kyros-Zylinder/master/assets/SDFInformation/Nagel1.sdf");return await e.text()}catch(e){throw console.error("Fehler beim Laden der SDF-Datei:",e),e}}(),F=function(e){const t=e.trim().split("\n"),n={bbox:{min:l.Vector3.Zero(),max:l.Vector3.Zero()},cellSize:0,res:l.Vector3.Zero(),numCells:0,distances:[]};for(let e=0;e<t.length;e++){const o=t[e].trim(),r=o.indexOf("#");if(-1!==r){const t=o.substring(0,r).trim();if(0===t.length)continue;const i=t.split(" ").map(parseFloat);i.length>0&&(0===e?n.bbox.min=l.Vector3.FromArray(i):1===e?n.bbox.max=l.Vector3.FromArray(i):2===e?n.cellSize=i[0]:3===e?n.res=l.Vector3.FromArray(i):4===e?n.numCells=i[0]:n.distances.push(...i))}else{const t=o.split(" ").map(parseFloat);t.length>0&&(0===e?n.bbox.min=l.Vector3.FromArray(t):1===e?n.bbox.max=l.Vector3.FromArray(t):2===e?n.cellSize=t[0]:3===e?n.res=l.Vector3.FromArray(t):4===e?n.numCells=t[0]:n.distances.push(...t))}}return n}(await I),V=new l.Mesh("boundingBox",f);V.setBoundingInfo(new l.BoundingInfo(F.bbox.min,F.bbox.max)),V.showBoundingBox=!0;const A=new r.Y("my first camera",0,Math.PI/3,10,new i.P(0,0,0),f);A.setTarget(i.P.Zero()),A.attachControl(t,!0);const O=(0,s.$6)("ground",{width:6,height:6},f),k=new a.K("ground material",f);k.diffuseTexture=new c.x(u.Z,f),O.material=k,O.receiveShadows=!0;const _=new d.O("light",new i.P(0,-1,1),f);_.intensity=.5,_.position.y=10;const B=new m.u(512,_);B.useBlurExponentialShadowMap=!0,B.blurScale=2,B.setDarkness(.2);const D=new a.K("collisionMaterial",f);D.diffuseColor=new l.Color3(1,0,0);const T=new a.K("noCollisionMaterial",f);T.diffuseColor=new l.Color3(0,1,0);const L=C.getChildMeshes(),N=w.AdvancedDynamicTexture.CreateFullscreenUI("UI"),E=w.Button.CreateSimpleButton("toggleCollisionCorrection","Toggle Collision Correction");E.width="150px",E.height="40px",E.background="red",E.color="white",E.left="35%",E.top="-45%";let Q=!1;E.onPointerClickObservable.add((()=>{Q=!Q,E.background=Q?"green":"red"})),N.addControl(E);const Z=await f.createDefaultXRExperienceAsync({floorMeshes:[O]}),R=(Z.baseExperience.sessionManager.session,P);let K=null,j=null,W=!1;return Z.input.onControllerAddedObservable.add((e=>{"right"===e.inputSource.handedness&&e.onMotionControllerInitObservable.add((()=>{const t=e.motionController?.getComponent("xr-standard-trigger");t&&t.onButtonStateChangedObservable.add((e=>{e.value>.5?W=!0:(W=!1,K=null,j=null)}))}))})),f.onBeforeRenderObservable.add((()=>{const e=L;let t=1,n=0;if(W){const e=Z.input.controllers.find((e=>"right"===e.inputSource.handedness));if(e&&e.grip&&e.grip.position&&e.grip.rotationQuaternion){const t=e.grip.position,n=e.grip.rotationQuaternion;if(t&&n&&K&&j){const e=i._f.Identity().multiply(n).multiply(j.conjugate()),o=t.subtract(K).divide(R.scaling);R.position.addInPlace(o.scaleInPlace(.01)),R.rotationQuaternion.multiplyInPlace(e)}K=t.clone(),j=n.clone()}}for(let o=0;o<L.length;o++){const r=h(e[o].absolutePosition,y,F);r<t&&-1!=r&&r<0&&(console.log("KOLLISSION"),t=r,n=o)}if(t>0)y.material=T;else if(y.material=D,Q){const o=e[n].absolutePosition,r=(P.absolutePosition,new i.P(z[n].x,z[n].y,z[n].z));let s=i.P.TransformNormal(r,P.getWorldMatrix());s=s.multiply(new i.P(-1,-1,-1)),console.log(s),function(e,t){const n=t.x-e.x,o=t.y-e.y,r=t.z-e.z;Math.sqrt(n*n+o*o+r*r)}(F.bbox.min,F.bbox.max);const a=function(e,t,n,o,r,i,s){const a=p(t,n,o,s,e);return new l.Vector3(s.x,s.y,s.z).multiply(new l.Vector3(a,a,a)).multiply(new l.Vector3(.4,.4,.4))}(t,F.bbox.min,F.bbox.max,o,0,0,s),c=function(e,t,n,o,r,i,s,a){const c=Math.pow(n.subtract(t).length(),2)/2,u=o.cross(s),d=5e4/(2*c)*p(t,n,o,s,e),m=u.multiply(new l.Vector3(d,d,d)),b=a.rotationQuaternion;return new l.Quaternion(m.x/2,m.y/2,m.z/2,0).multiply(b)}(t,F.bbox.min,F.bbox.max,o,0,0,s,P),u=P.absolutePosition.add(a);console.log("CurrentPosition: ",P.absolutePosition),console.log("PositionOffset: ",a),console.log("NewPosition: ",u);const d=P.rotationQuaternion.add(c);P.rotationQuaternion=d,P.position=new i.P(u.x,u.y,u.z)}})),f}}}const y=new f},1552:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"9b31293ea96c8dfa518b45622da82a13.jpg"}}]);
//# sourceMappingURL=426.babylonBundle.js.map